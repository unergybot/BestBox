server:
  host: "0.0.0.0"
  port: 5002
  debug: false

logging:
  level: INFO

pipeline:
  maas:
    enabled: false

  ocr_api:
    api_host: glm-transformers-service
    api_port: 11436
    model: glm-ocr
    api_path: /v1/chat/completions
    api_key: null
    connect_timeout: 300
    request_timeout: 1200
    connection_pool_size: 128

  max_workers: 2
  page_maxsize: 100
  region_maxsize: 800

  page_loader:
    max_tokens: 4096
    temperature: 0.01
    image_format: JPEG
    min_pixels: 12544
    max_pixels: 71372800
    pdf_dpi: 200

  result_formatter:
    output_format: both
    filter_nested: true
    min_overlap_ratio: 0.8
    label_visualization_mapping:
      table: [table]
      formula: [display_formula, inline_formula]
      image: [chart, image]
      text: [abstract, algorithm, content, doc_title, figure_title, paragraph_title, reference_content, text, vertical_text, vision_footnote, seal, formula_number]

  enable_layout: true
  layout:
    model_dir: PaddlePaddle/PP-DocLayoutV3_safetensors
    threshold: 0.55
    batch_size: 1
    workers: 1
    # cuda_visible_devices: "" # CPU override removed for GPU support
    layout_nms: true
    layout_unclip_ratio: [1.0, 1.0]
    
    layout_merge_bboxes_mode:
      0: large
      1: large
      2: large
      3: small  # chart - detect individual charts, don't merge
      4: large
      5: large
      6: large
      7: large
      8: large
      9: large
      10: large
      11: large
      12: large
      13: large
      14: small  # image - detect individual images, don't merge
      15: large
      16: large
      17: large
      18: small
      19: large
      20: large
      21: large
      22: large
      23: large
      24: large

    label_task_mapping:
      text: [abstract, algorithm, content, doc_title, figure_title, paragraph_title, reference_content, text, vertical_text, vision_footnote, seal, formula_number]
      table: [table]
      formula: [display_formula, inline_formula]
      skip: [chart, image]
      abandon: [header, footer, number, footnote, aside_text, reference, footer_image, header_image]

    id2label:
      0: abstract
      1: algorithm
      2: aside_text
      3: chart
      4: content
      5: display_formula
      6: doc_title
      7: figure_title
      8: footer
      9: footer_image
      10: footnote
      11: formula_number
      12: header
      13: header_image
      14: image
      15: inline_formula
      16: number
      17: paragraph_title
      18: reference
      19: reference_content
      20: seal
      21: table
      22: text
      23: vertical_text
      24: vision_footnote
